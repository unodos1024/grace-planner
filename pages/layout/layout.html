<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Grace Planner</title>
    <!-- Theme & Reset -->
    <link rel="stylesheet" href="../../css/common/theme.css">
    <link rel="stylesheet" href="../../css/common/reset.css">

    <!-- Layout Skeleton (Structural) -->
    <link rel="stylesheet" href="../../css/layout/layout.css">

    <!-- Component Library (Modular) -->
    <link rel="stylesheet" href="../../css/components/card.css">
    <link rel="stylesheet" href="../../css/components/bottom-sheet.css">
    <link rel="stylesheet" href="../../css/components/timer.css">
    <link rel="stylesheet" href="../../css/components/calendar.css">
    <link rel="stylesheet" href="../../css/components/navigation.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'><path d='M48 0 L48 48 L0 48 L0 25 Z' fill='%237B964D'/><path d='M52 0 L100 25 L100 48 L52 48 Z' fill='%23C6997A'/><path d='M0 52 L48 52 L48 100 L0 75 Z' fill='%238B89C3'/><path d='M52 52 L100 52 L100 75 L52 100 Z' fill='%23637A2C'/></svg>">
</head>

<body>
    <div class="shell-container">
        <!-- Desktop Sidebar -->
        <aside class="shell-sidebar" id="desktop-sidebar">
            <div class="sidebar-logo">
                <svg viewBox="0 0 100 100">
                    <path d="M48 0 L48 48 L0 48 L0 25 Z" fill="#7B964D" />
                    <path d="M52 0 L100 25 L100 48 L52 48 Z" fill="#C6997A" />
                    <path d="M0 52 L48 52 L48 100 L0 75 Z" fill="#8B89C3" />
                    <path d="M52 52 L100 52 L100 75 L52 100 Z" fill="#637A2C" />
                </svg>
                <span>Grace Planner</span>
            </div>

            <nav class="sidebar-nav" id="sidebar-nav-list">
                <!-- Injected via Navigation.js -->
            </nav>

            <div class="sidebar-user" id="sidebar-user-info">
                <div class="user-avatar" id="user-avatar-initial">?</div>
                <div class="user-info">
                    <span class="user-name" id="user-display-name">Loading...</span>
                    <span class="user-role" id="user-display-role">User</span>
                </div>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="shell-main">
            <!-- Mobile Top Bar -->
            <header class="mobile-top-bar">
                <h1 class="app-title">Grace Planner</h1>
                <div class="header-icons">
                    <button class="icon-btn" onclick="Router.navigate('notice')" title="알림" aria-label="알림 확인">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="notification-badge hidden" id="notification-badge">N</span>
                    </button>
                    <button class="icon-btn" onclick="Router.navigate('settings')" title="설정" aria-label="설정 메뉴 열기">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
                            </path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Page Content -->
            <div id="shell-content">
                <!-- Content injected by Router.js -->
            </div>

            <!-- Mobile Bottom Nav (Inside main to respect vertical flow) -->
            <div id="mobile-nav-container">
                <!-- Injected via Navigation.js -->
            </div>
        </main>

        <!-- Global Modal Root -->
        <div id="modal-root"></div>
    </div>

    <!-- Common Scripts -->
    <script src="../../js/common/constants.js"></script>
    <script src="../../js/common/utils.js"></script>
    <script src="../../js/common/api.js"></script>
    <script src="../../js/common/data.js"></script>
    <script src="../../js/common/auth.js"></script>
    <script src="../../js/common/navigation.js"></script>
    <script src="../../js/common/router.js"></script>
    <script src="../../js/common/core.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for Auth check
            const user = Auth.getCurrentUser();
            if (user) {
                // Update Sidebar User Info
                document.getElementById('user-display-name').innerText = user.name;
                document.getElementById('user-display-role').innerText = user.role === 'pastor' ? '목회자' : user.cohort + '기 훈련생';
                document.getElementById('user-avatar-initial').innerText = user.name[0];

                // Initialize Navigation
                Navigation.injectNavigation(user.role);

                // Check Notifications for Badge
                const updateNotificationBadge = () => {
                    const notices = window.Utils.getStorageItem('grace_walk_notices', []);
                    const lastViewed = window.Utils.getStorageItem('last_notice_view', 0);
                    const badge = document.getElementById('notification-badge');

                    if (badge) {
                        // Count unread notices (created after last view)
                        const unreadCount = notices.filter(n => new Date(n.date).getTime() > lastViewed).length;

                        if (unreadCount > 0) {
                            badge.classList.remove('hidden');
                            badge.innerText = unreadCount;
                        } else {
                            badge.classList.add('hidden');
                        }
                    }
                };

                // Update badge on load
                updateNotificationBadge();

                // Store function globally for notice page to call
                window.updateNotificationBadge = updateNotificationBadge;

                // Initialize Router
                Router.init();
            }
        });
    </script>
</body>

</html>