-- Oracle Cloud Free Tier (ATP) Schema for Grace Planner
-- Encoding: UTF-8

-- 1. DailyTask: 매일의 과제 수행 기록
CREATE TABLE DAILY_TASKS (
    TASK_ID         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID         NUMBER DEFAULT 1 NOT NULL, -- 현재는 단일 사용자
    TASK_DATE       DATE NOT NULL,             -- TRUNC(DATE) 기준
    TASK_TYPE       VARCHAR2(20) NOT NULL,     -- QT, PRAYER, BIBLE_90, STUDY, VERSE, BOOK, SERMON
    COMPLETED       CHAR(1) DEFAULT 'N' NOT NULL,
    DURATION        NUMBER DEFAULT 0,          -- 기도용 (분 단위)
    CREATED_AT      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT UQ_DATE_TYPE UNIQUE (TASK_DATE, TASK_TYPE)
);

-- 2. BibleReading90: 90일 통독 추적
CREATE TABLE BIBLE_READING_90 (
    DAY_INDEX       NUMBER PRIMARY KEY,        -- 1 ~ 90
    PERIOD_TYPE     VARCHAR2(10) NOT NULL,     -- FIRST (상반기), SECOND (하반기)
    COMPLETED_DATE  DATE,
    USER_ID         NUMBER DEFAULT 1 NOT NULL
);

-- 3. SermonNotes: 설교 요약
CREATE TABLE SERMON_NOTES (
    NOTE_ID         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    WORSHIP_TYPE    VARCHAR2(20) NOT NULL,     -- SUNDAY (주일), WEDNESDAY (수요)
    TITLE           VARCHAR2(100) NOT NULL,
    CONTENT         CLOB,                      -- 설교 요약 (Long Text)
    CREATED_DATE    DATE NOT NULL,
    CREATED_AT      TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 4. BookReviews: 독후감
CREATE TABLE BOOK_REVIEWS (
    REVIEW_ID       NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BOOK_ID         VARCHAR2(50) NOT NULL,     -- JSON Seed 데이터의 ID와 매핑
    CONTENT         CLOB,                      -- 독후감 내용
    CREATED_DATE    DATE NOT NULL,
    CREATED_AT      TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 인덱스 생성 (날짜 기반 조회가 많으므로)
CREATE INDEX IDX_TASKS_DATE ON DAILY_TASKS(TASK_DATE);
